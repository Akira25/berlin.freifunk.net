{% extends "layout.html" %}
{% block content %}
<div id="edges">
</div>
<style>
  .link {
    stroke: steelblue;
    stroke-opacity: .4;
    fill: none;
  }
</style>
<script>
var radius = 400,
    width = radius*3,
    height = radius*3,
    padding = 10,
    radians = 2 * Math.PI;



d3.json("{{url_for('api_nodes')}}", function(graph) {
  var g = new Graph(),
      edges = graph.edges;
  for (var i = 0; i < edges.length; i++) {
    var edge = edges[i],
        source = {'id': edge.source},
        target = {'id': edge.target},
        data = {'quality': edge.quality};

    g.addEdge(source, target, data);
  }

  var nodes = g.getNodes(),
      radianGen = d3.scale.linear()
        .domain([0, nodes.length])
        .range([0, 2 * Math.PI]);
  for (var i=0; i < nodes.length; i++) {
    var node = nodes[i];

    node.rad = radianGen(i);
    node.x = width/2 - radius*Math.cos(node.rad);
    node.y = height/2 - radius* Math.sin(node.rad);
  }

  var svg = d3.select("#edges").append("svg")
      .attr("width", width)
      .attr("height", height);

  var lineGen = d3.svg.line()
      .x(function(d) { return d.x; })
      .y(function(d) { return d.y; })
      .interpolate("monotone");

  svg.selectAll("text").data(nodes).enter()
    .append("g")
      .attr("transform", function(d) {
        return "translate(" + d.x + ", " + d.y + ")";
      })
    .append("text")
      .attr("transform", function(d,i) {
          return "rotate("+(d.rad*(180/Math.PI))+")"
      })
      .attr("dx", -8)
      .attr("text-anchor", "end")
      .attr('font-size', "12px")
      .text(function(d) { return d.getId(); });

  links = g.getEdges()
  for (var i=0; i < links.length; i++) {
    var link = links[i],
        lines = [
          link.source,
          link.target
        ];

    svg.append("path")
      .attr("d", lineGen(lines))
      .attr("class", "link")
      .attr("stroke", "blue")
      .attr("stroke-width", 1)
      .attr("fill", "none");
  }
});

</script>
{% endblock %}
